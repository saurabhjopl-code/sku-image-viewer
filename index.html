<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>SKU Image Finder</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 16px;
      background: #f7f7f7;
      color: #222;
      -webkit-touch-callout: none;
      user-select: none;
    }

    .container {
      max-width: 900px;
      margin: 0 auto;
      background: white;
      padding: 16px;
      border-radius: 12px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.12);
    }

    /* Branding on LOGIN only (logo, no text) */
    .branding {
      text-align: center;
      margin-bottom: 8px;
    }
    .branding img {
      max-width: 160px;
      height: auto;
      display: block;
      margin: 0 auto;
    }

    /* Login Screen */
    #login-screen .container {
      max-width: 400px;
      text-align: center;
    }
    .login-form {
      margin-top: 16px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    .login-form input,
    .login-form button {
      width: 100%;
      padding: 10px;
      font-size: 15px;
      border-radius: 4px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    .login-form button {
      background: #bfa36f;
      color: #fff;
      border: none;
      font-weight: bold;
      cursor: pointer;
    }
    .login-error {
      margin-top: 8px;
      font-size: 13px;
      color: #c00;
      min-height: 18px;
    }

    /* Top Bar on search screen */
    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 10px;
    }
    .top-bar-right button {
      padding: 6px 10px;
      font-size: 13px;
      border-radius: 4px;
      border: 1px solid #ccc;
      background: #f5f5f5;
      cursor: pointer;
    }

    /* Search Area */
    .search-bar {
      display: flex;
      gap: 8px;
      flex-direction: column;
      margin-bottom: 12px;
      position: relative;
    }
    input, button {
      padding: 10px;
      font-size: 15px;
      border-radius: 4px;
      border: 1px solid #ccc;
      box-sizing: border-box;
    }
    .search-bar button {
      background: #bfa36f;
      color: #fff;
      border: none;
      font-weight: bold;
      cursor: pointer;
    }

    .message {
      margin-top: 8px;
      font-size: 14px;
      color: #555;
      min-height: 18px;
    }

    /* Suggestions dropdown */
    .suggestions {
      position: absolute;
      top: 48px;
      left: 0;
      right: 0;
      background: #fff;
      border: 1px solid #ccc;
      border-top: none;
      border-radius: 0 0 4px 4px;
      max-height: 200px;
      overflow-y: auto;
      z-index: 30;
      display: none;
    }
    .suggestion-item {
      padding: 6px 10px;
      font-size: 14px;
      cursor: pointer;
      border-bottom: 1px solid #eee;
    }
    .suggestion-item:hover { background: #f3f3f3; }

    /* Results */
    .results {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
      margin-top: 14px;
    }
    @media (min-width: 480px) {
      .results { grid-template-columns: repeat(2, 1fr); }
    }
    @media (min-width: 900px) {
      .results { grid-template-columns: repeat(3, 1fr); }
    }

    .card {
      background: #fafafa;
      border: 1px solid #ddd;
      padding: 10px;
      border-radius: 8px;
    }
    .card-title { font-weight: bold; font-size: 14px; }
    .card-category { color:#bfa36f; font-size:12px; margin-top:2px; font-weight:600; }
    .card-sku { font-size: 12px; color: #666; margin-top: 3px; }

    .card-image-wrapper {
      margin-top: 6px;
      background: #000;
      border-radius: 6px;
      overflow: hidden;
      cursor: zoom-in;
    }
    .card-image-wrapper img {
      width: 100%;
      opacity: 0;
      transition: opacity .3s;
      -webkit-user-drag: none;
      user-select: none;
    }
    .card-image-wrapper img.loaded { opacity: 1; }

    mark { background: #ffeb3b; }

    /* Zoom Modal */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.75);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 50;
    }
    .modal-backdrop.show { display: flex; }
    .modal-content { max-width:92vw; max-height:92vh; position:relative; }
    .modal-close {
      position:absolute; top:-32px; right:0; font-size:30px; color:#fff; cursor:pointer;
    }
  </style>
</head>

<body>

<!-- LOGIN SCREEN -->
<div id="login-screen">
  <div class="container">
    <div class="branding">
      <img src="Rajnandini_Logo_Logo_WHITE_COLOR.jpg" alt="Logo">
    </div>
    <h3>Team Login</h3>

    <div class="login-form">
      <input type="email" id="loginEmail" placeholder="Email">
      <input type="password" id="loginPassword" placeholder="Password">
      <button id="loginButton">Login</button>
      <div class="login-error" id="loginError"></div>
    </div>
  </div>
</div>

<!-- MAIN APP SCREEN -->
<div id="app-screen" style="display:none;">
  <div class="container">

    <div class="top-bar">
      <div id="userEmail" style="font-size:14px;font-weight:bold;"></div>
      <div class="top-bar-right">
        <button id="logoutButton">Logout</button>
      </div>
    </div>

    <div class="search-bar">
      <input id="skuInput" placeholder="Search SKU or part (ex: 3026)" autocomplete="off">
      <button onclick="searchImages()">Search</button>
      <div class="suggestions" id="suggestions"></div>
    </div>

    <div class="message" id="message">Loading data...</div>
    <div class="results" id="results"></div>
  </div>
</div>

<!-- IMAGE MODAL -->
<div class="modal-backdrop" id="imageModal">
  <div class="modal-content">
    <div class="modal-close" id="modalClose">&times;</div>
    <img id="modalImage">
  </div>
</div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>

<script>
  // Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyD9oebZPuhL8ZngWCb87kY40pzKY9afiQE",
    authDomain: "sku-image-viewer.firebaseapp.com",
    projectId: "sku-image-viewer",
    storageBucket: "sku-image-viewer.firebasestorage.app",
    messagingSenderId: "106442502934",
    appId: "1:106442502934:web:bfdba7d1ebed7037fe9637",
    measurementId: "G-9B17HHRN44"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();

  const loginScreen = document.getElementById("login-screen");
  const appScreen = document.getElementById("app-screen");
  const loginEmail = document.getElementById("loginEmail");
  const loginPassword = document.getElementById("loginPassword");
  const loginError = document.getElementById("loginError");
  const logoutButton = document.getElementById("logoutButton");
  const userEmailDisplay = document.getElementById("userEmail");

  auth.onAuthStateChanged(user => {
    if (user) {
      userEmailDisplay.textContent = user.email;
      loginScreen.style.display = "none";
      appScreen.style.display = "block";
    } else {
      appScreen.style.display = "none";
      loginScreen.style.display = "block";
    }
  });

  document.getElementById("loginButton").onclick = async () => {
    loginError.textContent = "";
    try {
      await auth.signInWithEmailAndPassword(loginEmail.value, loginPassword.value);
    } catch (err) {
      loginError.textContent = "Invalid login details";
    }
  };

  logoutButton.onclick = async () => { await auth.signOut(); };

  // Prevent right-click (casual save)
  document.addEventListener("contextmenu", e => e.preventDefault());

  // SKU data
  let skuData = [];
  let dataLoaded = false;

  const skuInput = document.getElementById("skuInput");
  const suggestionsDiv = document.getElementById("suggestions");
  const resultsDiv = document.getElementById("results");
  const msg = document.getElementById("message");

  const imageModal = document.getElementById("imageModal");
  const modalImage = document.getElementById("modalImage");
  const modalClose = document.getElementById("modalClose");

  async function loadCSV() {
    const response = await fetch("sku_images.csv");
    const text = await response.text();
    const lines = text.trim().split(/[\r\n]+/);

    const header = lines[0].split(",");
    const iSKU = header.indexOf("SKU");
    const iIMG = header.indexOf("ImageLink");
    const iTITLE = header.indexOf("Title");
    const iCAT = header.indexOf("Category");

    for (let i = 1; i < lines.length; i++) {
      const p = lines[i].split(",");
      if (!p[iSKU] || !p[iIMG]) continue;
      skuData.push({
        sku: p[iSKU].trim(),
        imageLink: p[iIMG].trim(),
        title: (p[iTITLE] || "").trim(),
        category: (p[iCAT] || "").trim()
      });
    }

    dataLoaded = true;
    msg.textContent = "Ready.";
  }

  function highlight(text, q) {
    if (!text) return "";
    if (!q) return text;
    const lower = text.toLowerCase();
    const qq = q.toLowerCase();
    const idx = lower.indexOf(qq);
    if (idx === -1) return text;
    return (
      text.substring(0, idx) +
      "<mark>" + text.substring(idx, idx + q.length) + "</mark>" +
      text.substring(idx + q.length)
    );
  }

  function updateSuggestions(q) {
    if (!q) {
      suggestionsDiv.style.display = "none";
      return;
    }

    const matches = skuData
      .filter(i => i.sku.toLowerCase().includes(q.toLowerCase()))
      .slice(0, 10);

    if (!matches.length) {
      suggestionsDiv.style.display = "none";
      return;
    }

    suggestionsDiv.innerHTML = "";
    matches.forEach(item => {
      const div = document.createElement("div");
      div.className = "suggestion-item";
      div.innerHTML = highlight(item.sku, q);
      div.onclick = () => {
        skuInput.value = item.sku;
        suggestionsDiv.style.display = "none";
        searchImages();
      };
      suggestionsDiv.appendChild(div);
    });

    suggestionsDiv.style.display = "block";
  }

  async function searchImages() {
    const q = skuInput.value.trim().toLowerCase();
    resultsDiv.innerHTML = "";
    suggestionsDiv.style.display ="none";

    if (!dataLoaded) await loadCSV();
    if (!q) {
      msg.textContent = "Enter SKU";
      return;
    }

    const matches = skuData.filter(i => i.sku.toLowerCase().includes(q));

    msg.textContent = `Found ${matches.length} result(s)`;

    matches.forEach(i => {
      const card = document.createElement("div");
      card.className = "card";

      const titleEl = document.createElement("div");
      titleEl.className = "card-title";
      titleEl.innerHTML = highlight(i.title || i.sku, q);

      if (i.category) {
        const catEl = document.createElement("div");
        catEl.className = "card-category";
        catEl.textContent = i.category;
        card.appendChild(titleEl);
        card.appendChild(catEl);
      } else {
        card.appendChild(titleEl);
      }

      const skuEl = document.createElement("div");
      skuEl.className = "card-sku";
      skuEl.innerHTML = "SKU: " + highlight(i.sku, q);

      const wrap = document.createElement("div");
      wrap.className = "card-image-wrapper";

      const img = document.createElement("img");
      img.src = i.imageLink;
      img.onload = () => img.classList.add("loaded");
      wrap.onclick = () => openModal(i.imageLink);

      wrap.appendChild(img);
      card.appendChild(skuEl);
      card.appendChild(wrap);

      resultsDiv.appendChild(card);
    });
  }

  function openModal(src) {
    modalImage.src = src;
    imageModal.classList.add("show");
  }

  modalClose.onclick = () => imageModal.classList.remove("show");
  imageModal.onclick = e => { if (e.target === imageModal) imageModal.classList.remove("show"); };

  skuInput.addEventListener("keyup", e => {
    if (e.key === "Enter") searchImages();
    else updateSuggestions(skuInput.value);
  });

  window.addEventListener("load", () => {
    loadCSV().catch(() => { msg.textContent = "Error loading sku_images.csv"; });
  });
</script>

</body>
</html>
